<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criação de Personagem - RPG Player</title>
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="img/site.webmanifest">
    <link rel="shortcut icon" href="img/favicon.ico">
    
    <link rel="stylesheet" href="styles/character-creation.css">
</head>
<body>
    <div class="creation-container">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Raça & Classe</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Tendência</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Detalhes</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Atributos</div>
            </div>
            <div class="progress-step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Perícias</div>
            </div>
            <div class="progress-step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-label">Pontos de Vida</div>
            </div>
            <div class="progress-step" data-step="7">
                <div class="step-number">7</div>
                <div class="step-label">Idiomas</div>
            </div>
            <div class="progress-step" data-step="8">
                <div class="step-number">8</div>
                <div class="step-label">Personalidade</div>
            </div>
        </div>

        <!-- Form Steps -->
        <form id="characterForm" class="character-form">
            
            <!-- Step 1: Raça, Classe, Subclasse, Nível -->
            <div class="form-step active" data-step="1">
                <h2 class="step-title">⚔️ Escolha sua Raça & Classe</h2>
                <p class="step-description">Defina a essência do seu herói</p>
                
                <div class="form-group">
                    <label>🏰 Raça</label>
                    <button type="button" class="selection-btn" id="selectRaceBtn">
                        <span class="selection-label" id="selectedRaceLabel">Selecione uma raça...</span>
                        <span class="selection-icon">▼</span>
                    </button>
                    <input type="hidden" id="race" name="race" required>
                </div>

                <div class="form-group">
                    <label>⚔️ Classe</label>
                    <button type="button" class="selection-btn" id="selectClassBtn">
                        <span class="selection-label" id="selectedClassLabel">Selecione uma classe...</span>
                        <span class="selection-icon">▼</span>
                    </button>
                    <input type="hidden" id="class" name="class" required>
                </div>

                <div class="form-group" id="subclassGroup" style="display: none;">
                    <label>✨ Subclasse</label>
                    <button type="button" class="selection-btn" id="selectSubclassBtn">
                        <span class="selection-label" id="selectedSubclassLabel">Selecione uma subclasse...</span>
                        <span class="selection-icon">▼</span>
                    </button>
                    <input type="hidden" id="subclass" name="subclass">
                </div>

                <div class="form-group">
                    <label>📊 Nível</label>
                    <div class="level-selection-grid" id="levelSelectionGrid">
                        <!-- Levels 1-20 will be populated by JavaScript -->
                    </div>
                    <input type="hidden" id="level" name="level" required>
                </div>
            </div>

            <!-- Step 2: Tendência e Antecedente -->
            <div class="form-step" data-step="2">
                <h2 class="step-title">⚖️ Tendência & Antecedente</h2>
                <p class="step-description">Defina sua moralidade e passado</p>
                
                <div class="form-group">
                    <label>⚖️ Tendência</label>
                    <button type="button" class="selection-btn" id="selectAlignmentBtn">
                        <span class="selection-label" id="selectedAlignmentLabel">Selecione uma tendência...</span>
                        <span class="selection-icon">▼</span>
                    </button>
                    <input type="hidden" id="alignment" name="alignment" required>
                </div>

                <div class="form-group">
                    <label>📜 Antecedente</label>
                    <button type="button" class="selection-btn" id="selectBackgroundBtn">
                        <span class="selection-label" id="selectedBackgroundLabel">Selecione um antecedente...</span>
                        <span class="selection-icon">▼</span>
                    </button>
                    <input type="hidden" id="background" name="background" required>
                </div>
            </div>

            <!-- Step 3: Detalhes do Personagem -->
            <div class="form-step" data-step="3">
                <h2 class="step-title">🎭 Detalhes do Personagem</h2>
                <p class="step-description">Dê vida à aparência do seu herói</p>
                
                <div class="form-group">
                    <label for="characterName">✨ Nome do Personagem</label>
                    <input type="text" id="characterName" name="characterName" required placeholder="Digite o nome do seu herói...">
                </div>

                <div class="form-group">
                    <label for="characterImage">🖼️ Imagem do Personagem</label>
                    <div class="image-upload-container">
                        <div class="image-preview-wrapper" id="imagePreviewWrapper">
                            <div class="image-placeholder" id="imagePlaceholder">
                                <span class="placeholder-icon">🎭</span>
                                <span class="placeholder-text">Clique para adicionar imagem</span>
                            </div>
                            <img id="imagePreview" class="character-image-preview" style="display: none;">
                            <button type="button" class="btn-remove-image" id="removeImageBtn" style="display: none;">
                                <span>✕</span>
                            </button>
                        </div>
                        <input type="file" id="characterImage" name="characterImage" accept="image/*" style="display: none;">
                        <button type="button" class="btn-upload-image" id="uploadImageBtn">
                            📤 Escolher Imagem
                        </button>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eyes">👁️ Olhos</label>
                        <input type="text" id="eyes" name="eyes" placeholder="ex: Azuis profundos">
                    </div>
                    <div class="form-group">
                        <label for="skin">🎨 Pele</label>
                        <input type="text" id="skin" name="skin" placeholder="ex: Morena clara">
                    </div>
                    <div class="form-group">
                        <label for="hair">💇 Cabelo</label>
                        <input type="text" id="hair" name="hair" placeholder="ex: Castanho longo">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="weight">⚖️ Peso</label>
                        <input type="text" id="weight" name="weight" placeholder="ex: 70 kg">
                    </div>
                    <div class="form-group">
                        <label for="height">📏 Altura</label>
                        <input type="text" id="height" name="height" placeholder="ex: 1,75 m">
                    </div>
                    <div class="form-group">
                        <label for="age">🎂 Idade</label>
                        <input type="number" id="age" name="age" min="1" placeholder="ex: 25">
                    </div>
                </div>
            </div>

            <!-- Step 4: Atributos -->
            <div class="form-step" data-step="4">
                <h2 class="step-title">💪 Atributos</h2>
                <p class="step-description">Determine as capacidades fundamentais do seu herói</p>
                
                <div class="method-selection">
                    <h3 class="subsection-title">⚡ Escolha o método de geração:</h3>
                    <div class="method-buttons">
                        <button type="button" class="method-btn" data-method="4d6">
                            <div class="method-icon">🎲</div>
                            <div class="method-name">4d6 - Drop Lowest</div>
                            <div class="method-description">Role 4 dados e descarte o menor resultado</div>
                        </button>
                        <button type="button" class="method-btn" data-method="standard">
                            <div class="method-icon">📊</div>
                            <div class="method-name">Valores Padrão</div>
                            <div class="method-description">Use: 15, 14, 13, 12, 10, 8</div>
                        </button>
                    </div>
                </div>

                <div id="diceRolling" class="dice-rolling hidden">
                    <div class="dice-roll-header">
                        <h3>🎲 Rolagem de Dados</h3>
                        <div class="rolls-counter">
                            <span class="counter-label">Rolagens:</span>
                            <span class="counter-value"><span id="rollsCompleted">0</span> / 6</span>
                        </div>
                    </div>
                    
                    <div class="dice-animation-container">
                        <div class="dice-3d-container">
                            <div class="dice-3d" id="dice3d-1">
                                <div class="dice-face dice-front">1</div>
                                <div class="dice-face dice-back">6</div>
                                <div class="dice-face dice-right">3</div>
                                <div class="dice-face dice-left">4</div>
                                <div class="dice-face dice-top">5</div>
                                <div class="dice-face dice-bottom">2</div>
                            </div>
                            <div class="dice-3d" id="dice3d-2">
                                <div class="dice-face dice-front">1</div>
                                <div class="dice-face dice-back">6</div>
                                <div class="dice-face dice-right">3</div>
                                <div class="dice-face dice-left">4</div>
                                <div class="dice-face dice-top">5</div>
                                <div class="dice-face dice-bottom">2</div>
                            </div>
                            <div class="dice-3d" id="dice3d-3">
                                <div class="dice-face dice-front">1</div>
                                <div class="dice-face dice-back">6</div>
                                <div class="dice-face dice-right">3</div>
                                <div class="dice-face dice-left">4</div>
                                <div class="dice-face dice-top">5</div>
                                <div class="dice-face dice-bottom">2</div>
                            </div>
                            <div class="dice-3d" id="dice3d-4">
                                <div class="dice-face dice-front">1</div>
                                <div class="dice-face dice-back">6</div>
                                <div class="dice-face dice-right">3</div>
                                <div class="dice-face dice-left">4</div>
                                <div class="dice-face dice-top">5</div>
                                <div class="dice-face dice-bottom">2</div>
                            </div>
                        </div>
                        
                        <div class="dice-results-display hidden" id="diceResultsDisplay">
                            <div class="result-values">
                                <div class="result-value" id="result-1">?</div>
                                <div class="result-value" id="result-2">?</div>
                                <div class="result-value" id="result-3">?</div>
                                <div class="result-value lowest" id="result-4">?</div>
                            </div>
                            <div class="result-summary">
                                <span class="summary-label">Total (sem o menor):</span>
                                <span class="summary-value" id="rollTotal">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="rollDiceBtn" class="roll-btn">
                        <span class="btn-icon">🎲</span>
                        <span class="btn-text">Rolar Dados</span>
                    </button>
                    
                    <div class="rolled-values-pool">
                        <h4>📊 Valores Disponíveis:</h4>
                        <div class="values-pool" id="valuesPool">
                            <!-- Rolled values will appear here as draggable items -->
                        </div>
                    </div>
                </div>

                <div id="standardArray" class="standard-array hidden">
                    <div class="standard-header">
                        <h3>📊 Valores Padrão</h3>
                        <p>Arraste os valores para os atributos correspondentes</p>
                    </div>
                    <div class="values-pool" id="standardValuesPool">
                        <!-- Standard array values: 15, 14, 13, 12, 10, 8 -->
                    </div>
                </div>

                <div id="attributeAssignment" class="attribute-assignment hidden">
                    <h3>⚔️ Distribua os valores nos atributos:</h3>
                    <p class="drag-instruction">Arraste os valores da pool acima para cada atributo</p>
                    <div class="attributes-drag-grid">
                        <div class="attribute-drop-zone" data-attribute="str">
                            <div class="attribute-label">
                                <span class="attr-icon">💪</span>
                                <span class="attr-name">Força</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-str">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-str">+0</div>
                        </div>
                        
                        <div class="attribute-drop-zone" data-attribute="dex">
                            <div class="attribute-label">
                                <span class="attr-icon">🏹</span>
                                <span class="attr-name">Destreza</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-dex">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-dex">+0</div>
                        </div>
                        
                        <div class="attribute-drop-zone" data-attribute="con">
                            <div class="attribute-label">
                                <span class="attr-icon">❤️</span>
                                <span class="attr-name">Constituição</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-con">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-con">+0</div>
                        </div>
                        
                        <div class="attribute-drop-zone" data-attribute="int">
                            <div class="attribute-label">
                                <span class="attr-icon">🧠</span>
                                <span class="attr-name">Inteligência</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-int">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-int">+0</div>
                        </div>
                        
                        <div class="attribute-drop-zone" data-attribute="wis">
                            <div class="attribute-label">
                                <span class="attr-icon">🦉</span>
                                <span class="attr-name">Sabedoria</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-wis">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-wis">+0</div>
                        </div>
                        
                        <div class="attribute-drop-zone" data-attribute="cha">
                            <div class="attribute-label">
                                <span class="attr-icon">✨</span>
                                <span class="attr-name">Carisma</span>
                            </div>
                            <div class="attribute-value-slot" id="slot-cha">
                                <span class="slot-placeholder">Arraste aqui</span>
                                <span class="slot-value hidden"></span>
                            </div>
                            <div class="attribute-modifier" id="mod-cha">+0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Perícias -->
            <div class="form-step" data-step="5">
                <h2 class="step-title">🎯 Perícias</h2>
                <p class="step-description">Escolha as especialidades do seu personagem</p>
                
                <div class="skills-info">
                    <p>Escolha <strong><span id="skillsToChoose">2</span></strong> perícia(s)</p>
                    <div class="legend">
                        <span class="legend-item"><span class="box checked"></span> Do antecedente</span>
                        <span class="legend-item"><span class="box available"></span> Disponível</span>
                        <span class="legend-item"><span class="box disabled"></span> Não disponível</span>
                    </div>
                </div>

                <div class="skills-grid" id="skillsGrid">
                    <!-- Skills will be populated by JavaScript -->
                </div>
            </div>

            <!-- Step 6: Pontos de Vida -->
            <div class="form-step" data-step="6">
                <h2 class="step-title">❤️ Pontos de Vida</h2>
                <p class="step-description">Determine a resistência vital do seu herói</p>
                
                <div class="hp-method-selection">
                    <h3 class="subsection-title">⚡ Como deseja calcular seus pontos de vida?</h3>
                    <div class="method-buttons">
                        <button type="button" class="method-btn" data-hp-method="average">
                            <div class="method-icon">📊</div>
                            <div class="method-name">Valor Médio</div>
                            <div class="method-description">Valor fixo e consistente por nível</div>
                        </button>
                        <button type="button" class="method-btn" data-hp-method="roll">
                            <div class="method-icon">🎲</div>
                            <div class="method-name">Rolagem de Dados</div>
                            <div class="method-description">Role o dado de vida para cada nível</div>
                        </button>
                    </div>
                </div>

                <div id="hpCalculation" class="hp-calculation hidden">
                    <div class="hp-summary">
                        <h3>Seus Pontos de Vida:</h3>
                        <div class="hp-display">
                            <div class="hp-value">
                                <span id="totalHP">0</span>
                                <label>Total</label>
                            </div>
                        </div>
                        <div class="hp-breakdown" id="hpBreakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Idiomas e Proficiências -->
            <div class="form-step" data-step="7">
                <h2 class="step-title">🗣️ Idiomas e Proficiências</h2>
                <p class="step-description">Amplie as capacidades do seu personagem</p>
                
                <div id="extraChoices" class="extra-choices">
                    <div class="extra-section" id="languageSection">
                        <h3>🌍 Idiomas Adicionais</h3>
                        <p>Escolha <strong><span id="languagesToChoose">0</span></strong> idioma(s) adicional(is)</p>
                        <div class="choices-grid" id="languagesGrid"></div>
                    </div>

                    <div class="extra-section" id="proficiencySection">
                        <h3>🛠️ Proficiências Adicionais</h3>
                        <p>Escolha <strong><span id="proficienciesToChoose">0</span></strong> proficiência(s) adicional(is)</p>
                        <div class="choices-grid" id="proficienciesGrid"></div>
                    </div>
                </div>
            </div>

            <!-- Step 8: Traços de Personalidade -->
            <div class="form-step" data-step="8">
                <h2 class="step-title">🎭 Personalidade</h2>
                <p class="step-description">Defina a essência emocional e moral do seu herói</p>
                
                <div class="personality-section">
                    <div class="personality-category">
                        <h3>✨ Traços de Personalidade</h3>
                        <p class="category-hint">Características marcantes que definem o comportamento do seu personagem</p>
                        <div class="personality-controls">
                            <button type="button" class="random-btn" data-category="traits">🎲 Sortear</button>
                            <button type="button" class="choose-btn" data-category="traits">📋 Escolher da Lista</button>
                        </div>
                        <textarea id="traits" name="traits" rows="3" placeholder="Digite ou sorteie traços de personalidade..."></textarea>
                    </div>

                    <div class="personality-category">
                        <h3>⚖️ Ideais</h3>
                        <p class="category-hint">Os valores e princípios que guiam suas ações e decisões</p>
                        <div class="personality-controls">
                            <button type="button" class="random-btn" data-category="ideals">🎲 Sortear</button>
                            <button type="button" class="choose-btn" data-category="ideals">📋 Escolher da Lista</button>
                        </div>
                        <textarea id="ideals" name="ideals" rows="3" placeholder="Digite ou sorteie um ideal..."></textarea>
                    </div>

                    <div class="personality-category">
                        <h3>🔗 Vínculos</h3>
                        <p class="category-hint">Conexões pessoais, pessoas, lugares ou eventos importantes</p>
                        <div class="personality-controls">
                            <button type="button" class="random-btn" data-category="bonds">🎲 Sortear</button>
                            <button type="button" class="choose-btn" data-category="bonds">📋 Escolher da Lista</button>
                        </div>
                        <textarea id="bonds" name="bonds" rows="3" placeholder="Digite ou sorteie um vínculo..."></textarea>
                    </div>

                    <div class="personality-category">
                        <h3>⚠️ Defeitos</h3>
                        <p class="category-hint">Fraquezas, medos ou falhas que tornam seu personagem humano</p>
                        <div class="personality-controls">
                            <button type="button" class="random-btn" data-category="flaws">🎲 Sortear</button>
                            <button type="button" class="choose-btn" data-category="flaws">📋 Escolher da Lista</button>
                        </div>
                        <textarea id="flaws" name="flaws" rows="3" placeholder="Digite ou sorteie um defeito..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="form-navigation">
                <button type="button" id="prevBtn" class="nav-btn prev-btn" disabled>← Anterior</button>
                <button type="button" id="nextBtn" class="nav-btn next-btn">Próximo →</button>
                <button type="submit" id="submitBtn" class="nav-btn submit-btn hidden">Criar Personagem ✓</button>
            </div>
        </form>
    </div>

    <!-- Modal de Seleção de Raça -->
    <div id="raceSelectionModal" class="modal">
        <div class="modal-content selection-modal">
            <span class="close">&times;</span>
            <h2>🏰 Escolha sua Raça</h2>
            <div class="selection-grid" id="raceSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Classe -->
    <div id="classSelectionModal" class="modal">
        <div class="modal-content selection-modal">
            <span class="close">&times;</span>
            <h2>⚔️ Escolha sua Classe</h2>
            <div class="selection-grid" id="classSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Subclasse -->
    <div id="subclassSelectionModal" class="modal">
        <div class="modal-content selection-modal">
            <span class="close">&times;</span>
            <h2>✨ Escolha sua Subclasse</h2>
            <div class="selection-grid" id="subclassSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Antecedente -->
    <div id="backgroundSelectionModal" class="modal">
        <div class="modal-content selection-modal">
            <span class="close">&times;</span>
            <h2>📜 Escolha seu Antecedente</h2>
            <div class="selection-grid" id="backgroundSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Tendência -->
    <div id="alignmentSelectionModal" class="modal">
        <div class="modal-content selection-modal alignment-modal">
            <span class="close">&times;</span>
            <h2>⚖️ Escolha sua Tendência</h2>
            <p class="modal-subtitle">Defina o alinhamento moral e ético do seu personagem</p>
            <div class="alignment-grid" id="alignmentSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Método -->
    <div id="methodConfirmModal" class="modal">
        <div class="modal-content confirm-modal">
            <h2>⚠️ Confirmação de Método</h2>
            <div class="confirm-message">
                <p>Você tem certeza que deseja usar o método:</p>
                <div class="method-display" id="selectedMethodDisplay"></div>
                <p class="warning-text">⚠️ Após confirmar, você NÃO poderá mudar de método!</p>
            </div>
            <div class="confirm-actions">
                <button type="button" class="btn-cancel-confirm" id="cancelMethodBtn">❌ Cancelar</button>
                <button type="button" class="btn-confirm-method" id="confirmMethodBtn">✅ Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal for Subrace Selection -->
    <div id="subraceSelectionModal" class="modal">
        <div class="modal-content selection-modal">
            <span class="close" onclick="characterCreation.backToRaceModal()">&times;</span>
            <h2>✨ Selecione uma Sub-raça</h2>
            
            <!-- Race info display will be inserted here by JS -->
            <!-- Subrace info display will be inserted here by JS -->
            
            <div class="selection-grid" id="subraceSelectionGrid">
                <!-- Populated by JavaScript -->
            </div>
            
            <!-- Action buttons will be inserted here by JS -->
        </div>
    </div>

    <!-- OLD Modal for Subraces (deprecated) -->
    <div id="subraceModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="raceTitle">Raça Selecionada</h2>
            
            <div class="race-info" id="raceInfo">
                <!-- Race benefits will be displayed here -->
            </div>

            <div class="subraces-container" id="subracesContainer">
                <h3>Sub-raças Disponíveis:</h3>
                <div id="subracesList"></div>
            </div>

            <div class="modal-actions">
                <button type="button" id="keepRaceBtn" class="btn-secondary">Permanecer com a Raça</button>
            </div>
        </div>
    </div>

    <!-- Modal for Choosing Personality Traits -->
    <div id="personalityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="personalityTitle">Escolher Traço</h2>
            
            <div class="personality-list" id="personalityList">
                <!-- Personality options will be displayed here -->
            </div>
        </div>
    </div>

    <script type="module" src="js/character-creation.js"></script>
</body>
</html>
